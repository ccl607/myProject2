<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm-->
<!-- mapper 태그 선언 -->
<!--mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm-->
	<!-- namespace 속성값으로 [DAO 인터페이스명]이 오며 -->
	<!-- [DAO 인터페이스] 메소드명과 동일한 id 값을 소유한 태그를 내포하고 있다. -->
<!--mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm-->
<mapper namespace="com.group4.erp.dao.myWorkDAO">
	<sql id="MyWorkSearchWere">
		<if test="(search_keyword!=null and search_keyword.length()>0)">
			and(
			    upper(b.ISBN13) like upper('%${search_keyword}%')
			    or upper(b.book_name) like upper('%${search_keyword}%')
			    or upper(cc.cat_name) like upper('%${search_keyword}%')
			    or upper(book_price) like upper('%${search_keyword}%')
			    or upper(si.ISBN_cnt) like upper('%${search_keyword}%')
			    or upper(cb.branch_name) like upper('%${search_keyword}%')
		    )
		</if>
		
		<if test="(category!=null and category.length>0)">
			and
			<foreach collection="category" item="category" open="(" separator="or" close=")">
				b.cat_cd = to_number(${category})
			</foreach>
		</if>
	</sql>
	
	<select id='getMyCareBookList' parameterType="com.group4.erp.MyWorkSearchDTO" resultType="java.util.HashMap">
		select * from(select zzz.*, rownum RNUM from(
			select
				b.ISBN13 					as "ISBN13"
				,b.book_name 				as "book_name"
				,cc.cat_name				as "cat_name"
				,b.book_price  				as "book_price"
				,b.emp_no||''					as "emp_no"
				,b.editor						as "editor"
				,si.ISBN_cnt				as  "ISBN_Cnt"
				,cb.branch_name				as  "branch_name"
			from book b, code_category cc, stock_info si, code_branch cb
			where b.cat_cd = cc.cat_cd and b.ISBN13 = si.ISBN13 and si.branch_cd = cb.branch_cd
			<include refid="MyWorkSearchWere" />
			
			order by ISBN13 asc
		) zzz ) where <![CDATA[ RNUM>=${selectPageNo*rowCntPerPage-rowCntPerPage+1} and RNUM<=${selectPageNo*rowCntPerPage} ]]>
			
	</select>
	
	<select id='getCategoryList' resultType="java.util.HashMap">
		select
			cat_cd		as	"cat_cd"
			, cat_name	as	"cat_name"
		from code_category
		where 1=1
	</select>
	
	<select id='getBookSizeList' resultType="java.util.HashMap">
		select
			size_cd		as	"size_cd"
			, size_name	as	"size_name"
		from code_book_size
		where 1=1
	</select>
	
	<select id='getBranchList' resultType="java.util.HashMap">
		select
			branch_cd		as	"branch_cd"
			, branch_name	as	"branch_name"
		from code_branch
		where 1=1
	</select>
	
	<select id='getPublisherList' resultType="java.util.HashMap">
		select distinct publisher	as	"publisher" from book
	</select>
<!-- 	
	<select id='getMyWorkListAllCnt' resultType="int">
		select count(*) from book
	</select>
 -->
	<select id='getMyWorkListAllCnt' parameterType="com.group4.erp.MyWorkSearchDTO" resultType="int">
		select count(*)from(
			select b.*, cc.cat_name, si.ISBN_Cnt, cb.branch_name from book b, code_category cc, stock_info si, code_branch cb
	        	where cc.cat_cd = b.cat_cd and b.ISBN13 = si.ISBN13 and si.branch_cd = cb.branch_cd
				<include refid="MyWorkSearchWere" />
		)
	</select>

</mapper>