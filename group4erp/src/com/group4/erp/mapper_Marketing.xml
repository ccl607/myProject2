<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm-->
<!-- mapper 태그 선언 -->
<!--mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm-->
	<!-- namespace 속성값으로 [DAO 인터페이스명]이 오며 -->
	<!-- [DAO 인터페이스] 메소드명과 동일한 id 값을 소유한 태그를 내포하고 있다. -->
<!--mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm-->
<mapper namespace="com.group4.erp.dao.MarketingDAO">
	 
	<sql id="eventWhere">
		<if test="searchKeyword !=null">
				and (
					upper(ei.evnt_no) like upper('%${searchKeyword}%') 
					or upper(ei.evnt_title) like upper('%${searchKeyword}%')
					or upper(ei.tot_est_cost) like upper('%${searchKeyword}%')
					or upper(ei.tot_cost) like upper('%${searchKeyword}%')
					or upper(ei.evnt_start_dt) like upper('%${searchKeyword}%')
					or upper(ei.evnt_end_dt) like upper('%${searchKeyword}%')
				)			
		</if>
		
		<if test="evnt_stat != null">
			and
			<foreach collection="evnt_stat" item="evnt_stat"  open="(" separator=" or " close=")">
				<if test="evnt_stat.equals('01')">
					ei.evnt_state_cd='01'
				</if>
				<if test="evnt_stat.equals('02')">
					ei.evnt_state_cd='02'
				</if>
				<if test="evnt_stat.equals('03')">
					ei.evnt_state_cd='03'
				</if>
				<if test="evnt_stat.equals('04')">
					ei.evnt_state_cd='04'
				</if>
				
			</foreach>			
		</if>
		
		<if test="evnt_category != null">
			and
			<foreach collection="evnt_category" item="evnt_category"  open="(" separator=" or " close=")">
				<if test="evnt_category.equals('01')">
					ei.evnt_cd='01'
				</if>
				<if test="evnt_category.equals('02')">
					ei.evnt_cd='02'
				</if>
				<if test="evnt_category.equals('03')">
					ei.evnt_cd='03'
				</if>
				<if test="evnt_category.equals('04')">
					ei.evnt_cd='04'
				</if>
				<if test="evnt_category.equals('05')">
					ei.evnt_cd='05'
				</if>
				<if test="evnt_category.equals('06')">
					ei.evnt_cd='06'
				</if>
				<if test="evnt_category.equals('07')">
					ei.evnt_cd='07'
				</if>
				
			</foreach>			
		</if>
	</sql>
	
	<sql id="headerSort">
		<if test="sort!=null and sort.length() > 0" >
			order by ${sort}
		</if>
		
		<if test="sort==null">
			order by 1
		</if>
	</sql>
	
	 
	<select id='getEventCnt' parameterType = "com.group4.erp.EventSearchDTO" resultType="int">
		select count(*) from event_info ei
		where 1=1
		<include refid="eventWhere" />
	</select>
	
	
	<select id='getEventList' parameterType="com.group4.erp.EventSearchDTO" resultType="com.group4.erp.EventDTO">
	select * from (select zzz.*, rownum RNUM from (
		select
        	ei.evnt_no "evnt_no",
            (select e.emp_name from employee e where e.emp_no= ei.emp_no) "emp_name",
            (select c.event_type from code_event c where c.event_cd = ei.evnt_cd) "evnt_category",
            ei.evnt_title "evnt_title",
            ei.tot_est_cost||'' "tot_est_cost",
            ei.tot_cost||'' "tot_cost",
            to_char(ei.evnt_start_dt, 'yyyy-mm-dd') || '('||to_char(ei.evnt_start_dt, 'dy', 'nls_date_language=Korean' )||')' "evnt_start_dt",
            to_char(ei.evnt_end_dt, 'yyyy-mm-dd') || '('||to_char(ei.evnt_start_dt, 'dy', 'nls_date_language=Korean' )||')' "evnt_end_dt",
            (select s.evnt_state_name from code_ad_state s where s.evnt_state_cd = ei.evnt_state_cd) "evnt_stat",
            ei.evnt_comment "evnt_comment",
            ei.atchd_data "atchd_data"
        from event_info ei
		where 1=1		
		<include refid="eventWhere" />
		<include refid="headerSort" />
		) zzz) where RNUM&gt;= ${selectPageNo * rowCntPerPage - rowCntPerPage +1} and RNUM&lt;=${selectPageNo * rowCntPerPage}
	</select>

	 
	
	
	
	<select id='getAdApplyCnt' resultType="int">
		select count(*) from ad_apply_info
	</select>
	
	<select id='getAdApplyList' resultType="com.group4.erp.AdApplyDTO">
		    select
        	ai.ad_apply_no||'' "ad_apply_no",
        	ai.corp_no "corp_no",
        	ai.applicant_name "applicant_name",
        	ai.ad_title "ad_title",
        	ai.reg_dt "reg_dt",
        	ai.open_req_dt "open_req_dt",
        	(select c.open_req_area_name from code_open_req_area c where c.open_req_area_cd = ai.open_req_area_cd) "open_req_area",
        	(select s.evnt_state_name from code_ad_state s where s.evnt_state_cd = ai.ad_state_cd) "ad_stat"
        from ad_apply_info ai
		where 1=1
	</select>
	
		
</mapper>