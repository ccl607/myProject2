<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm-->
<!-- mapper 태그 선언 -->
<!--mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm-->
	<!-- namespace 속성값으로 [DAO 인터페이스명]이 오며 -->
	<!-- [DAO 인터페이스] 메소드명과 동일한 id 값을 소유한 태그를 내포하고 있다. -->
<!--mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm-->
<mapper namespace="com.group4.erp.dao.WorkDAO">
	<!-- 
	<select id='getMyCareBookList' parameterType="com.group4.erp.MyCareBookListDTO" resultType="java.util.HashMap">
		select
				ISBN13 					as "ISBN13"
				,book_name 				as "book_name"
				,(select cc.cat_name from code_category cc where cc.cat_cd=b.cat_cd)
							as "cat_name"
				,book_price  			as "book_price"
				,book_pages||'' 		as "book_pages"
				,writer 				as "writer"
				,publisher 				as "publisher"
				,size_cd||'' 			as "size_cd"
				,is_not_print 			as "is_not_print"
				,emp_no||''				as "emp_no"
				,to_char(published_dt,'YYYY-MM-DD') as "published_dt" 
				,editor					as "editor"
			from book b	
			where emp_no = 1
	</select>
	 
	 <select id='getBusinessTripListCnt' resultType="int">
		select count(*) from work_outside_info
	</select>
	
	 -->
	<select id="getBusinessTripList"  parameterType="com.group4.erp.BusinessTripSearchDTO" resultType="java.util.HashMap">
		select
			rownum||''             as "rownum"
    		,c.jikup               as "jikup"
    		,e1.emp_name           as "emp_name"
    		,d.dep_name             as "dep_name"
    		,w.destination         as "destination"
    		,w.work_outside_reason as "work_outside_reason"
    		,to_char(w.outside_start_time,'yyyy-mm-dd am hh12:mi:ss (dy)','NLS_DATE_LANGUAGE=korean')  as "outside_start_time"
    		,to_char(w.outside_end_time,'yyyy-mm-dd am hh12:mi:ss (dy)','NLS_DATE_LANGUAGE=korean')    as "outside_end_time"
    		,nvl(e2.emp_name,' ')  as "mgr_name"
	    from work_outside_info w inner join employee e1 on w.emp_no=e1.emp_no
	    	 inner join code_jikup c on c.jikup_cd=e1.jikup_cd
	    	 inner join dept d on d.dep_no=e1.dep_no
     		 left outer join employee e2 on e2.emp_no=e1.mgr_emp_no
     	where 1=1
     		<if test="searchKey!=null and !searchKey.equals('')">
     			<if test="keyword!=null and !keyword.equals('')">
					<if test ="searchKey.equals('jikup')">
						and c.jikup like '%'||#{keyword}||'%'
					</if>
					<if test ="searchKey.equals('emp_name')">
						and e1.emp_name like '%'||#{keyword}||'%'
					</if>
					<if test ="searchKey.equals('dep_name')">
						and d.dep_name like '%'||#{keyword}||'%'
					</if>
					<if test ="searchKey.equals('destination')">
						and w.destination like '%'||#{keyword}||'%'
					</if>
					<if test ="searchKey.equals('mgr_name')">
						and mgr_name like '%'||#{keyword}||'%'
					</if>
     			</if>
     		</if> 
	</select>
</mapper>